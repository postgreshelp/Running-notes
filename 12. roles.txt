owner of my database kfc_db is kfc_user.
only superuser can create roles.

1. create two roles, kfc_dba, kfc_dev
2. Assign read privileges on kfc_user to kfc_dev
3. Assign all privileges on kfc_user to kfc_dba
4. Create 4 users, kfc_dba1, kfc_dba2, kfc_dev1, kfc_dev2
5. Grant kfc_dev to kfc_dev1, kfc_dev2
6. Grant kfc_dba to kfc_dba1, kfc_dba2
7. Audit their activity.


kfc_db=# create role kfc_dba;
CREATE ROLE
kfc_db=# create role kfc_dev;
CREATE ROLE
kfc_db=#

kfc_db=> grant connect on database kfc_db to kfc_dev;
GRANT
kfc_db=> grant usage on schema kfc_user to kfc_dev;
GRANT
kfc_db=> grant select on all tables in schema kfc_user to kfc_dev;
GRANT
kfc_db=>

kfc_db=> grant connect on database kfc_db to kfc_dba;
GRANT
kfc_db=> grant usage on schema kfc_user to kfc_dba;
GRANT
kfc_db=> grant all on all tables in schema kfc_user to kfc_dba;
GRANT
kfc_db=>

kfc_db=#
kfc_db=# create user kfc_dba1 with password 'kfc_dba1';
CREATE ROLE
kfc_db=# create user kfc_dba2 with password 'kfc_dba2';
CREATE ROLE
kfc_db=# create user kfc_dev1 with password 'kfc_dev1';
CREATE ROLE
kfc_db=# create user kfc_dev2 with password 'kfc_dev2';
CREATE ROLE
kfc_db=#

kfc_db=#
kfc_db=# grant kfc_dba to kfc_dba1;
GRANT ROLE
kfc_db=# grant kfc_dba to kfc_dba2;
GRANT ROLE
kfc_db=# grant kfc_dev to kfc_dev1;
GRANT ROLE
kfc_db=# grant kfc_dev to kfc_dev2;
GRANT ROLE
kfc_db=#

postgres=# alter user kfc_dba1 set search_path=kfc_user;
ALTER ROLE
postgres=# alter user kfc_dba2 set search_path=kfc_user;
ALTER ROLE
postgres=# alter user kfc_dev1 set search_path=kfc_user;
ALTER ROLE
postgres=# alter user kfc_dev2 set search_path=kfc_user;
ALTER ROLE
postgres=#


log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
log_connections = on
log_disconnections = on


postgres=# alter user kfc_dba1 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dba2 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dev1 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dev2 set log_statement='all';
ALTER ROLE
postgres=#

check membership information
============================
\drg







student/dept..

create table emp (
sid int;
sname varchar(100);
sdept int;
sdept_name varchar(100);
sdept address varchar(100);
slocation varchar(100);
sphno int;
);


create table emp (
sid int;
sname varchar(100);
sdept int;
);

create table dept (
did int;
sdept_name varchar(100)
sdept address varchar(100)
);

create table location (
sid int;
locid int;
location varchar(100));























##create roles

postgres=#
postgres=# create role kfc_dba;
CREATE ROLE
postgres=# create role kfc_dev;
CREATE ROLE
postgres=# \q

## assign privileges to roles

[postgres@lab03 ~]$ psql -U kfc_user -d kfc_db
psql (16.3)
Type "help" for help.

kfc_db=> grant connect on database kfc_db to kfc_dev;
GRANT
kfc_db=> grant usage on schema kfc_user to  kfc_dev;
GRANT
kfc_db=> grant select on all tables in schema kfc_user to kfc_dev;
GRANT
kfc_db=>
kfc_db=> grant connect on database kfc_db to kfc_dba;
GRANT
kfc_db=> grant usage on schema kfc_user to  kfc_dba;
GRANT
kfc_db=> grant all on all tables in schema kfc_user to  kfc_dba;
GRANT
kfc_db=>

### create users

kfc_db=> \c - postgres
You are now connected to database "kfc_db" as user "postgres".
kfc_db=#
kfc_db=# create user kfc_dba1 with password 'kfc_dba1';
CREATE ROLE
kfc_db=# create user kfc_dba2 with password 'kfc_dba2';
CREATE ROLE
kfc_db=#
kfc_db=# create user kfc_dev1 with password 'kfc_dev1';
CREATE ROLE
kfc_db=# create user kfc_dev2 with password 'kfc_dev2';
CREATE ROLE
kfc_db=#

### grant role to users

kfc_db=# grant kfc_dba to kfc_dba1;
GRANT ROLE
kfc_db=# grant kfc_dba to kfc_dba2;
GRANT ROLE

kfc_db=# grant kfc_dev to kfc_dev1;
GRANT ROLE
kfc_db=# grant kfc_dev to kfc_dev2;
GRANT ROLE


## audit the activity

[postgres@lab03 16]$ psql
psql (16.3)
Type "help" for help.

postgres=# alter user kfc_dev1 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dev2 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dba1 set log_statement='all';
ALTER ROLE
postgres=# alter user kfc_dba2 set log_statement='all';
ALTER ROLE
postgres=#

kfc_db=# alter user kfc_dev1 set search_path=kfc_user,public;
ALTER ROLE
kfc_db=# alter user kfc_dev2 set search_path=kfc_user,public;
ALTER ROLE
kfc_db=# alter user kfc_dba1 set search_path=kfc_user,public;
ALTER ROLE
kfc_db=# alter user kfc_dba2 set search_path=kfc_user,public;
ALTER ROLE
kfc_db=#

Testing
-------
[postgres@lab03 16]$ psql -U kfc_dev1 -d kfc_db
psql (16.3)
Type "help" for help.

kfc_db=>

kfc_db=> select * from emp;
 id | sal
----+-----
  1 | 100
(1 row)

kfc_db=> delete from emp;
ERROR:  permission denied for table emp
kfc_db=> \q

2024-07-10 07:49:05 IST:[local]:kfc_dev1@kfc_db:[5608]: LOG:  statement: select * from emp;
2024-07-10 07:49:20 IST:[local]:kfc_dev1@kfc_db:[5608]: LOG:  statement: delete from emp;
2024-07-10 07:49:20 IST:[local]:kfc_dev1@kfc_db:[5608]: ERROR:  permission denied for table emp
2024-07-10 07:49:20 IST:[local]:kfc_dev1@kfc_db:[5608]: STATEMENT:  delete from emp;

AS a DBA role
-------------
[postgres@lab03 16]$ psql -U kfc_dba1 -d kfc_db
psql (16.3)
Type "help" for help.

kfc_db=> select * from emp;
 id | sal
----+-----
  1 | 100
(1 row)

kfc_db=> delete from emp;
DELETE 1
kfc_db=> insert into emp values(1,100);
INSERT 0 1
kfc_db=>

2024-07-10 07:50:10 IST:[local]:kfc_dba1@kfc_db:[5693]: LOG:  statement: select * from emp;
2024-07-10 07:50:15 IST:[local]:kfc_dba1@kfc_db:[5693]: LOG:  statement: delete from emp;
2024-07-10 07:50:25 IST:[local]:kfc_dba1@kfc_db:[5693]: LOG:  statement: insert into emp values(1,100);


